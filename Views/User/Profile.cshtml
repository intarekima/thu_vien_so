@{
    ViewData["Title"] = "Trang cá nhân";
    Layout = "~/Views/Shared/User/_Layout.cshtml";
}

<div class="container my-5 profiles">
    <ul class="nav nav-tabs border-0" id="documentTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active font-weight-bold" id="purchased-tab" data-toggle="tab" href="#purchased" role="tab"
               aria-controls="purchased" aria-selected="true" style="color: var(--primary);">
                Tài liệu đã mua
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link font-weight-bold" id="pending-tab" data-toggle="tab" href="#pending" role="tab"
               aria-controls="pending" aria-selected="false" style="color: var(--primary);">
                Tài liệu chờ thanh toán
            </a>
        </li>
        @* <li class="nav-item">
            <a class="nav-link font-weight-bold" id="viewed-tab" data-toggle="tab" href="#viewed" role="tab"
               aria-controls="viewed" aria-selected="false" style="color: var(--primary);">
                Tài liệu đã xem
            </a>
        </li> *@
    </ul>

    <div class="tab-content border p-4 shadow-sm" id="documentTabsContent">
        <!-- Tab 1: Đã mua -->
        <div class="tab-pane fade show active" id="purchased" role="tabpanel" aria-labelledby="purchased-tab">
            @if (Model != null && Model.Count > 0)
            {
                <div class="row">
                    @foreach (var payment in Model)
                    {
                        var doc = payment.Document;
                        <div class="col-md-6 mb-4">
                            <div class="card shadow-sm h-100 border-0">
                                <div class="card-body d-flex flex-column justify-content-between">
                                    <div>
                                        <h5 class="card-title text-dark font-weight-bold">@doc.Title</h5>
                                        <span class="badge badge-primary">Đã thanh toán: @payment.PercentPaid?.ToString("0.##")%</span><br />
                                        <small class="text-muted">Ngày thanh toán: @payment.UpdatedAt?.ToString("dd/MM/yyyy")</small>
                                    </div>

                                    <div class="mt-3 d-flex justify-content-between">
                                        <a href="/document/@doc.Id" class="btn btn-sm btn-outline-primary">
                                            Xem tài liệu
                                        </a>
                                        <a href="/document/download/@doc.Id" class="btn btn-sm btn-outline-primary">
                                            <i class="fa fa-download mr-1"></i> Tải xuống
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="alert alert-warning">Bạn chưa mua tài liệu nào.</div>
            }

        </div>


        @* Tab 2: Chờ thanh toán *@
        <!-- Tab 2: Chờ thanh toán -->
        <div class="tab-pane fade" id="pending" role="tabpanel" aria-labelledby="pending-tab">
            @{
                var pendingDocs = ViewBag.PendingDocs as List<thuvienso.Models.Payment>;
            }
            <div class="row">
                @foreach (var payment in pendingDocs)
                {
                    var doc = payment.Document;
                    <div class="col-md-6 mb-4">
                        <div class="card shadow-sm h-100 border-0">
                            <div class="card-body d-flex flex-column justify-content-between">
                                <div>
                                    <h5 class="card-title text-dark font-weight-bold">@doc.Title</h5>
                                    <span class="badge badge-warning">Chờ thanh toán: @payment.PercentPaid%</span><br />
                                    <small class="text-muted">Tạo lúc: @payment.CreatedAt.ToString("dd/MM/yyyy HH:mm")</small>
                                </div>

                                <div class="mt-3 d-flex justify-content-between">
                                    <a href="/document/@doc.Id" class="btn btn-sm btn-outline-primary">
                                        Xem tài liệu
                                    </a>
                                    <a href="@payment.CheckoutUrl" class="btn btn-sm btn-primary">
                                        Tiếp tục thanh toán
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>


        <!-- Tab 2: Đã xem -->
        @* <div class="tab-pane fade" id="viewed" role="tabpanel" aria-labelledby="viewed-tab">
            ĐANG PHÁT TRIỂN
        </div> *@
    </div>
</div>

<style>
    .profiles .nav-tabs .nav-link.active {
        border-bottom: 3px solid var(--primary);
        background-color: #fff;
    }

    .profiles .nav-tabs .nav-link:hover {
        text-decoration: underline;
    }
</style>
